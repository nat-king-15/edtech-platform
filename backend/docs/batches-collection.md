# Batches Collection Structure

## Overview
The `batches` collection in Firestore stores batch information for the EdTech platform. Each batch belongs to a specific course and contains scheduling, pricing, and teacher information.

## Collection Path
```
firestore/batches/{batchId}
```

## Document Structure

### Required Fields
- `title` (string): Batch title/name.
- `courseId` (string): Reference to the parent course document ID.
- `description` (string): Detailed batch description.
- `price` (number): Batch price in the base currency.
- `teachers` (array): Array of teacher objects with their details.
- `startDate` (string): ISO date string for the batch start date and time.
- `status` (string): Batch status - either 'draft' or 'published'.

### Optional Fields
- `endDate` (string): ISO date string for the batch end date and time.
- `maxStudents` (number): Maximum number of students allowed.
- `currentStudents` (number): Current number of enrolled students.
- `createdAt` (string): ISO date string when the batch was created.
- `updatedAt` (string): ISO date string when the batch was last updated.
- `createdBy` (string): UID of the admin who created the batch.
- `schedule` (object): Weekly schedule information.
- `duration` (string): Total duration (e.g., "3 months", "6 weeks").

## Teacher Object Structure
Each object in the `teachers` array has the following structure:
```json
{
  "name": "John Doe",
  "subject": "Mathematics",
  "imageUrl": "https://example.com/images/john-doe.jpg"
}
```

## Example Document
```json
{
  "title": "Advanced Math - Morning Batch",
  "courseId": "course-123-abc",
  "description": "Morning batch for advanced mathematics covering calculus and algebra",
  "price": 15000,
  "teachers": [
    {
      "name": "Dr. Sarah Johnson",
      "subject": "Calculus",
      "imageUrl": "https://example.com/images/sarah-johnson.jpg"
    },
    {
      "name": "Prof. Mike Chen",
      "subject": "Algebra",
      "imageUrl": "https://example.com/images/mike-chen.jpg"
    }
  ],
  "startDate": "2024-02-01T09:00:00.000Z",
  "endDate": "2024-05-01T11:00:00.000Z",
  "status": "published",
  "maxStudents": 30,
  "currentStudents": 0,
  "createdAt": "2024-01-15T10:30:00.000Z",
  "updatedAt": "2024-01-15T10:30:00.000Z",
  "createdBy": "admin-uid-123",
  "duration": "3 months",
  "schedule": {
    "days": ["Monday", "Wednesday", "Friday"],
    "time": "09:00-11:00",
    "timezone": "Asia/Kolkata"
  }
}
```

## Status Values
- `draft`: Batch is being prepared and not visible to students.
- `published`: Batch is live and available for enrollment.

## Security Rules
The collection should be protected with Firestore security rules:
- Only admins can create, update, or delete batches.
- Students can read published batches.
- Teachers can read batches they are assigned to.
- Draft batches are only visible to admins.

## Indexing
Recommended indexes for efficient queries:
- `courseId` (ascending)
- `status` (ascending)
- `startDate` (ascending)
- `price` (ascending)
- `createdAt` (descending)
- Composite: `courseId` + `status`
- Composite: `status` + `startDate`

## Validation Rules
1. `courseId` must reference an existing course document.
2. `price` must be a positive number.
3. `status` must be either 'draft' or 'published'.
4. `startDate` must be a valid date.
5. `teachers` array must contain at least one teacher.
6. Each teacher object must have required fields: `name`, `subject`, `imageUrl`.
7. `maxStudents` should be greater than 0 if specified.

## Usage Notes
1. Batch IDs are auto-generated by Firestore.
2. Always validate that `courseId` exists before creating a batch.
3. Update the `updatedAt` timestamp on every modification.
4. Soft delete by changing status instead of removing documents.
5. The `teachers` array should be validated for proper structure.
6. The price should be stored in the smallest currency unit (e.g., paise for INR) when integrating with a payment gateway like Razorpay.
